# 文件系统

文件系统包含两个不同部分：文件集合，每一个文件都会存储相对应的数据；目录结构，用来组织和提供这些文件信息（并非文件本身的内容信息）。

文件即信息的**逻辑存储单位**，在系统看来文件的本质是存储在外存的二进制集合。

文件是**按名存取**，文件还包含文件类型（扩展名）、位置（目录位置）、大小、时间、用户类型、权限。

文件类型可以指示文件的内部结构，操作系统可以通过文件类型做出不同的处理，当然也可以人为指定处理方式。

对于操作系统来说，最少要支持两种文件的处理：文本文件、二进制可执行文件，其中二进制可执行文件在不同操作系统也是不一致的，如Windows是PE文件、Linux是ELF文件。如对于Linux来说：./文件名 就是让告诉linux这是一个可执行文件，linux会读取文件的内容，选择对应的解释器去执行它，sh也可以代替./，如果sh命令是明确指定用shell解释器。至于其他文件，则需要操作系统根据对应**文件类型**选择对应的应用程序打开。

# 文件内部结构

![image](https://user-images.githubusercontent.com/48977889/149881725-0134789f-660c-48d7-9647-74a569b59ffc.png)

有以1字节为单位给逻辑文件打包，最终**分段**打包成扇区的大小，存储在硬盘不同的扇区内。

也可以以特定大小为单位给逻辑文件打包，最终也是分段打包成扇区的大小存储在硬盘不同的扇区内，区别是单位不再是1byte，**每个逻辑文件的大小可以不一致，最终能打包成扇区大小即可**。

# 文件目录

![image](https://user-images.githubusercontent.com/48977889/149881595-f8a9eff5-ac93-4c49-bc2b-95771465486d.png)

目录最终存放于硬盘的一个扇区内，不同文件系统对于entry的值划分是不同的，但大部分都是由文件名作为key。操作系统对于文件的操作很大程度上都是通过操作entry来完成，如查询、创建、删除、列出、重命名、遍历。

# Linux文件系统

## iNode

iNode值是**目录项**记录信息的一部分，用来指向文件在磁盘的位置。它的值代表磁盘中**iNode区**的iNode编号，最终读出对应的iNode。iNode里包含文件真实的扇区位置。最终通过扇区位置找到文件的内容。

![image](https://user-images.githubusercontent.com/48977889/149882280-87aa18b2-f216-4821-864d-3d59b046bec6.png)

如上图所示，这个操作系统的目录存在磁盘的第二个分区里，步骤如下

1.操作系统先通过文件名test在目录里找到目录项，目录项内记录了iNode值=12。

2.通过12在iNode分区内找到12号iNode，12号iNode里存储了test文件的真实扇区位置33025，最终操作系统通过33025找到test文件的内容。

3.补充：如果test文件还分段存储在33025、58扇区位置，那么12号iNode也会记录这两个扇区位置。

stat $filename，找到iNode值

debugfs $分区目录 进入交互命令：

blocks $filename：找到文件的物理块号（扇区位置）

删除的时候，实际是删除目录项，但硬盘内还未彻底删除。