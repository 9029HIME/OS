# 回顾进程

讲线程之前，首先说一下进程切换的开销。

![6392e7395f84c1f8c717fe73f4aed22](https://user-images.githubusercontent.com/48977889/145759282-ec34875e-3181-4b38-8f49-2512f0408ef6.jpg)

可以看到，当OS内有多个进程的话，更多的时间是花在不同进程之间的上下文切换，而不是执行程序的代码。直接以“进程”作为OS的调度单位开销会很大，因此需要一个层级比进程更小的调度单位，即“线程”。

# 线程与进程

![1ccc3b9f0cdce441f277bd81d1fdf9a](https://user-images.githubusercontent.com/48977889/145759292-a9aeb5e8-a446-44fb-8823-aac8e7e628ad.jpg)

 一个进程默认只有一个执行流，即线程。单线程拥有该进程的所有资源，可以将这个线程理解为进程本身。若进程派生了多个线程，多个线程之间共享同一个父进程的代码、data区、操作系统资源（如文件、信号），**每个线程都有它自己的PC、registers区（存放执行时各种CPU寄存器的值）、stack区、线程ID**。

线程会作为一个调度单位，被CPU调度，它与进程一样既有并发调度也有并行调度，具体要看实际的调度场景。线程的调度开销会比进程小（TODO 在线程切换时讲），同等数量下，多线程会有更多的时间去执行程序代码。

